pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- virtua racing title cart
-- @freds72
-- assets: sega

function lerp(a,b,t)
	return a*(1-t)+b*t
end

function printb(s,x,y,c)
	x=x or 64-(#s*2.5)
    for i=-1,1 do
        for j=-1,1 do
            print(s,x+i,y+j,0)
        end
    end
    print(s,x,y,c)
end

-- game states
-- transition to next state
function next_state(state)
	draw_state,update_state=state()
end


function title_state()
	local vrtext="711111117777777711117777111111117771111177777777111111771111111177777711777777777777777711777777111111111111111111111111111111111111111177777777111177771111111177711111777777771111111711111111777777117777777777777777777777771111111711111111111111111111111111111111777777771111777711111111777111117777777711111117111111117777771177777777777777777777777711111777111111111111111111111111111111117777777711177777111111117777111177777777111111171111111177777711777777777777777777777777111177771111111111111111111111111111111177777771111777771111111177771111777777771111111111111111777777117777777777777777777777771117777711111111111111111111111111111111777777711117777711111111777711117777777711111111111111117777771177777777777777777777777711777777111111111111111111111111111111117777777111777777111111117777711177777777111111111111111177777711777777777777777777777777117777771111111111111111111111111111111177777711117777771111111177777111177777771111111111111111777777117777777777777777777777771777777711111111111111111111111111111111777777111177777711111111777771111777777711111111111111117777771177777777777777777777777717777777111111111111111111111111111111117777711117777777111111117777771111777777111111111111111177777711117777771111111177777771177777771111111111111111111111111111111177777111177777771111111177777711117777771111111111111111777777111177777711111111777771111777777711111111111111111111111111111111777771111777777711111111777777111177777711111111111111117777771111777777111111117777711117777777111111111111111111111111111111117777111177777777111111117777777111177777111111111111111177777711117777771111111177777111177777771111111111111111111111111111111177771111777777771111111177777771111777771111111111111111777777111177777711111111777777111777777711111111111111111111111111111111777711117777777711111111777777711117777711111111111111117777771111777777111111117777777717777777111111111111111111111111111111117771111177777777111111117777777111117777111111111111111177777711777777777777777777777777117777771111111111111111111111111111111177711111777777771111111777777777111177771111111111111111777777117777777777777777777777771177777711111111111111111111111111111111777111117777777711111117777777771111177711111111111111117777771177777777777777777777777711177777111111111111111111111111111111117711111177777777111111177777777711111777111111111111111177777711777777777777777777777777111177771111111111111111111111111111111177111111777777777111117777777777111117771111111111111111777777117777777777777777777777771111177711111111111111111111111111111111711111117777777771111177777777771111117711111111111111117777771177777777777777777777777711111177111111111111111111111111111111117111111177777777711111777777777711111177111111111111111177777711777777777777777777777777111111111111111111111111111111111111111171111111777777777711177777777777111111771111111111111111777777117777777777777777117777771111111111111111111111111111111111111111111111117777777777111777777777771111111711111111111111117777771177777777777777771777777711111111111111111111111111111111111111111111111177777777771117777777777711111117111111111111111177777711117777777777771177777777111111171111111111111111111111111111111111111111777777777771177777777777111111111111111111111111777777111177777777771111777777771111111711111111111111111111111111111111111111117777777177717777777777771111111111111111111111117777771111777777777111117777777711111177111111111111111111111111111111111111111177777771777177777777777711111111111111111111111177777711117777777711111177777777111117771111111111111111111111111111111111111111777777117771777717777777111111111111111111111111777777111177777777111111777777771111177711111111111111111111111111111111111111117777771177777777177777777711111177777777111111177777771111777777711111117777777711117777777111117777777711111111111111111111111177777711777777771777777777111111777777771111111777777711117777777111111177777777111177777771111177777777111111111111111111111111777771117777777711777777771111117777777711111117777777111177777711111111777777771117777777711111777777771111111111111111111111117777711177777777117777777711111177777777111111177777771111777777111111117777777111777777777111117777777711111111111111111111111177777111777777771177777777111111777777771111111777777711117777771111111177777771117777777771111177777777111111111111111111111111777711117777777711177777771111117777777711111117777777111177777711111111777777111777777777711111777777771111111111111111111111117777111177777777111777777711111177777777111111177777771111777777111111117777771117777777777111117777777711111111111111111111111177711111777777771111777777111111777777771111111777777711117777771111111177777111777777777771111177777777111111111111111111111111777111117777777711117777771111117777777711111117777777111177777711111111777771117777777777711117777777771111111111111111111111117771111177777777111177777711111177777777111111177777771111777777111111117777111177777777777111177777777711111111"
	return
		-- draw
		function()
			cls(1)

			local mem=0x6000+64*43
			for i=1,#vrtext,8 do
				poke4(mem,tonum("0x"..sub(vrtext,i,i+3).."."..sub(vrtext,i+4,i+7)))
			 	mem+=4
			end
			pal(8,0)
			sspr(55,64,54,12,17,50)
			sspr(55,76,59,15,54,65)
			pal()
			sspr(55,64,54,12,16,49)
			sspr(55,76,59,15,53,64)
			-- print("virtua\nracing",48,60,7)
		end,
		-- update
		function()
			if btnp(4) or btnp(5) then
				next_state(selection_state)
			end
		end
end

function selection_state()
	local t=0
	local track=0
 local track_tgt=0
	local track_spr={
		{0,0,level="beginner",c=7},
		{54,0,level="medium",c=7},
		{0,56,level="expert",c=10}
	}
 local width=54+12
	return
		-- draw
		function()
			cls(13)        
			map(0,0,t%8-8,t%8-8,17,17)
			printb("⬅️ select track ➡️",28,2,7)            
			if track_tgt==track and t%4<2 then
				rectfill(34,9,93,70,10)
			end
			palt(0,false)
			local x=-width*track_tgt
			for i=1,#track_spr do
				local s=track_spr[i]
				sspr(s[1],s[2],54,56,flr(64+x-54/2),12,54,56)
				x+=width
			end
			if track_tgt==track then
				local s=track_spr[track+1]
				printb(s.level,nil,74,s.c)
				-- track records
				
			end
			palt()
		end,
		-- update
		function()
			t+=1
			if(btnp(0)) track-=1
			if(btnp(1)) track+=1					
			track=mid(track,0,2)

			local k=track
   track_tgt=lerp(track_tgt,k,0.18)
   -- snap when close to target
			if abs(track_tgt-k)<0.01 then
				track_tgt=k
			end			
		end
end

function _init()
	-- init state machine
	next_state(title_state)
end

function _update()
	-- basic state mgt
	update_state()
end

function _draw()
	draw_state()
end
__gfx__
33333333333bbbbbbbb33bbbbb3bb3bbbbbbb33b333333333333334f41333331111fff4333333333333333333344113113333333333300000000000000000000
33333333333bbbbb3333333b3bbbbbbbbbbbb3b333333333333333333ff5111115fff433333333333333333333f4411111133333333300000000000000000000
3333333333b3b3333333333333333333bb33bbbbb3b33333333333333333ffff4344333333133333333333333333fffffff13333333300000000000000000000
33333333bbbbb3333333333334f44333333333bbbb33333333333333333333333333333333131111111133333333344fffff3333333300000000000000000000
33333333bbbb333333366666666344f4343ff33bbbb33333333333333333333333333333333111111111331333333333333f3333333300000000000000000000
3333333bb3bb333360000000000000066634ff333333bbb333333333333333333333333333700000000d1111333333333f133333333300000000000000000000
3333333333bbb33600066666666000000066644f33333bbb33333333333333333333333337000d777d00d111333333333f133333333300000000000000000000
3333333333b3336006f111cccccccf336660006fffff33bbb33333333333333333333333d0075544f44d00d11133333333f13333333300000000000000000000
333333b33b33336006511c1c1ccfff3bb3360056fcccf333b33333333313333333333331d00d44ffffffd00d1113333333411333333300000000000000000000
33333b33bb33336006f1fff11cfb3bbb333f400ccc1cc333bbb333111111333333333311d00dcccccccccdd000d11333333f3333333300000000000000000000
3333333bb333336006ff33fff33bbbbb334419091cccc3bbbb3b33111111313333333311d00dcccccccccc4ddd0dd133333f3333333300000000000000000000
33333333bb333360063bb33b333333b33441190091cc33bbbbb333fff4111113333314ffd00dc1111cccccccf4d00d3333413333333300000000000000000000
5333333bbb33336006bbbbb333bb3bb344411190911c33bbb3b333cfff41111111114f88888888111111ccccffd00dd333f43333333300000000000000000000
f433333bbbb33360063bbb33b3bbb3334541119009cc5bbbb33333cccccff111554ffcc8d00d81111111cccccfd00dd333443333333300000000000000000000
c4f4533bbbbb3360063b33b3bbb333345f11111999ccf3bbb33333ccccccffffffffccc8d00d81111111111ccfd00dd331333333333300000000000000000000
cccf433bbbbb33600633bb3bbbb3333451111119091cc53bb33333c1cc1ccccffffcccc870078111111111cccf7007d341333333333300000000000000000000
1c1cff33bbb33360063bb33bbbb334ff41111119091ccf33b3333311111ccccccccccc18d00d8111111111cccfd00dd333f31333333300000000000000000000
1111cff3bb333360063bb3b3bb3b34fff11111199911c333b33b33111111c1cccc1cc1c8d00d8111111111cccfd00dd333f31333333300000000000000000000
1111ccfbbb333360063bb3bb33333343ff451119991cc33bbb3bb3111111111cc11c11187007811111111ccccf7007d333f41333333300000000000000000000
1111cccbbb33336006333b3333333333ff45111909ccf33bbbbb3311111111111c11111870078111111111cccf7007d333f13333333300000000000000000000
111ccc4b3b33336006333b33333344ff4445419009cf333b33333311111111111111111870078111111111cccf7007d344433333333300000000000000000000
c1c1c3b3b3333360063bbbb3b3334fff545f11909ccf333333333311111111111111111870078111111111cccf7007d34f133333333300000000000000000000
c43ccbbbb33333600633bbb33333f4f5f5f1190911ff3333333333111111111111111118700781111111111ccfd00dd4ff133333333300000000000000000000
33fcfbbbb33336600633bb33333345f11111909111cf443333354f111111111111111118d00d811111111111cc7007d441333333333300000000000000000000
334fbbbb333366600633bb33334f451111190091111cf4443344f4111111111111111118d00d811111111111ccd00dd4f5131333333300000000000000000000
b3bbbbbb333655000633b3334fff4f11119009111f11cccf45fccc11111111111111111870078111111111111cd00dd344113333333300000000000000000000
33bbbbbb33367500063bb334ffff441111909111f3f1c1ccfff1c11111111111111111187007811111111111ccd00dd344133333333300000000000000000000
3333bbbbb3367500063bbbb3334551111900911f33fc1cc1c11111111111111111111118700781111111111cccd00dd334133333333300000000000000000000
33333bbbb3365500063bbbbb3b355551190911133b3f4c44cc1111111111111111111118d00d81111111111cccd00dd334f13333333300000000000000000000
333333bbb336550006333bbb3bb3344f6009333bbbbb3333333f4c111111111111111188888888111111111cccd000d334ff3333333300000000000000000000
333333bbb336750005763b33bbbb3ff46006333bbbb3333333b3fc111111111111111111d00d1111111111cccc1d0003334f1333333300000000000000000000
333333bbb3365a0005763333bbbb33f3600633b33bb3333333bb33111111111111111111d000d111111111cccf133d0073331133333300000000000000000000
333333bb3336a60005763333333b333f3600633333bbbbbbbbbbbb111111111111111111d0000d1111111ccccc44337000734f41133300000000000000000000
333333bbb336aa0005763b333333bb3f46006333333bb333bb3bbb111111111111111111d00d0d1111111ccccc4f4437000d4ff4133300000000000000000000
333333bbb336aa00053333bbb33bbbb3f36006333333333333bbbb111111111111111111d00d0d1111111cccccff44f13d00dfff433300000000000000000000
333333bbb336a600057633bbbbbbbbbb33360063333333333333bb111111111111111111d00d0d11111111cc1ccff4ff4d00d3fff33300000000000000000000
3333bbbb3336a600057633bbbbbbbbbbbb33600633333333333333111111111111111111d00d0d1111111111c1ccccfffd00d3ff511300000000000000000000
333bbbbbb336aa00053333bbb33333bbbb3f60064333334433333311111111111111111cd00d0d111111111111cccccf4d00d3fff11100000000000000000000
33bbbbbbb336aa00057633334fff43bbbb33f60563334f443334f31111111111111cccffd00d0d11111111111111cccf3d00d14ff11300000000000000000000
33bbbbbbb336a60005763333fffff333b333f600633fff433333f3111111111111cccf44d00d0d1111111111111ccccf3d00d1fff11100000000000000000000
33bbbbbb3336a600063333360000063f3ff436006ff33333bb3453111111111cccf44511d00d0d1111111111111cccf3d000d354f44100000000000000000000
33bbbbbb3336a600063b3f000666600633336006ff333bbbbbb34f1111111ccc44451111d00d0dc1cccccccc11cccffd000d3315f51400000000000000000000
33bbbbbbb3635a00063b3f00634ff6006336006ff333b3bbbbb35f77d777dddd77dd113370070dccccccccc1c1cccf3d000d3154444f00000000000000000000
333bbbb336335560063b34006f333f45000054f4333bb333bbb34f000000000000000d3370070dccffff4cccccccf3d000d315444fff00000000000000000000
333bbbb3f3333360063334006f3b33f450054f3333b333333bb33477d777dddd77d00d337007dfff4f4f4fcccccffd0000d15444ff4400000000000000000000
33bbb333f3333360063b3400733bb3b3ffff3bb3333333333bbb331111ccf445111d0dd0700731151111544fcccf3d0000d35444444400000000000000000000
33bbb333f333336006333f006f33bbb33443b3bbb333333333bbb3cccccf4411113d0d007007311133331111fcff5d0d00d31444455400000000000000000000
3bbbb333f333336006333f00634433bbbbbbbbbb3b3333333b3bbbffff411111333d0007d00d3333d0000d3155111d0d00d35555115400000000000000000000
3bbbb333f333336006333f00633443bbbb3bbbbb3bb33333333bbbff45513113333d00d3d00d3337000000d15111d00700d31115311400000000000000000000
333bb333f3333360064f43006333f43bbbb3bb33333333333333bb4511133333333d00d3d00d3d000d333d00d3d00d1d00d33333333300000000000000000000
3333bb33ff333360006660006334f3bbbb333b33333333333333331111113333333d00d3d00d3d00d333333d0000000d00d00000000000000000000000000000
33333bb34f33333600000006333bf33bbb333b3b3333333333b33b1113333333333d00d3d00d3d00d3333333d000000d00d00000000000000000000000000000
333bbbb33f3333336666666333bf433bb333333333333333333b333333333333333d00d3d00d3d00d33333333333333d00d33333333300000000000000000000
33333b3334f3333333333333334f33bbb333bb33333333333333333333333333333d0007d00d7000d33333333333333d00d33333333300000000000000000000
33333333334f33333333333334f3333b333b33333333333333333333333333333333d000d00d000d333333333333333d00d33333333300000000000000000000
333333333334f433333333334f4333333333333333333333333333333333333333333dd0d00d0dd3333333333333333d00d33333333300000000000000000000
66666fffffff6ffff6666666444444466ffffff6ff66666666666600777777770000000000000000000000000000000000000000000000000000000000000000
66666ffffff6fffff4466444444444466f66fff6666fff6666ff6600666666670000000000000000000000000000000000000000000000000000000000000000
666f6ff6466f44444444444466666644466646ff66666ff666ffff00666666660000000000000000000000000000000000000000000000000000000000000000
66666f6466644454444444666666664444444ff666f66666666fff00666666660000000000000000000000000000000000000000000000000000000000000000
66666f6444445554666666666666f6644444446f6fff66f6f666ff00666666660000000000000000000000000000000000000000000000000000000000000000
6f666ff444555446666446666666664466645544f666f64666ff6f00666666660000000000000000000000000000000000000000000000000000000000000000
ff6666444454446f664444444444444444644544f6646664666fff00666666660000000000000000000000000000000000000000000000000000000000000000
666ff666444666666444455555544555546664444444444444446600666666660000000000000000000000000000000000000000000000000000000000000000
6ffff6ff444666664445555555555555544666445444544455444608880000000888088800000000000080000000000000000000000000000000000000000000
ffff66ff4466666f4445560000000000644666644444444555554400888000008880088800000000008880000000000000000000000000000000000000000000
ffff6fff446f64664444600000000000064466664444446444554400888000008880000000000000008880000000000000000000000000000000000000000000
46f66f44466f64444460063333333366006446646666666666445400888800088880088800888088088888800888000888000088888800000000000000000000
6666f4444666644447006336666666f6006444644466664666644400088800088800088800888880088888800888000888000888888880000000000000000000
4446644446444447007336666666ffff600644444444445644466600088800088800088800888000008880000888000888008880008880000000000000000000
4444446666644600733666f6666f46ff660064445555555544446600088880888800088800888000008880000888000888000000888880000000000000000000
444444666644600733666f633336f46f646006667777766555444600008880888000088800888000008880000888000888000888888880000000000000000000
4444466644600633666f630000003464444600000000000065544400008880888000088800888000008880000888000888008888008880000000000000000000
44446664460063366666300066003444444466666666666006544400000888880000088800888000008880000888000888008880008880000000000000000000
666666444600666666430063360034444446fccccccccccc60064400000888880000088800888000008888800888888888008888888880000000000000000000
6666644446006f66664300733700364446fccccccccccccc60064400000888880000088800888000000888800088880888000888808880000000000000000000
4446464446006f6f6443007337003fcccccccccccccccccc60075508888888800000000000000000000000000888000000000000000000000000000000000000
4444444556006ffff443007337003fcccccccccccccccccc60075508888888880000000000000000000000000888000000000000000000000000000000000000
4444445337007fff6443006337003fcccccccccccccccccc60065508880008880000000000000000000000000000000000000000000000000000000000000000
5553333bb6006fff4443006337003fccccccccccccccccc006545408880008880000088888800000888880000888008880888800000888088800000000000000
33333bbbb6006fff46f6300636003fcccccccccccccccc6065444408880008880000888888880008888888000888008888888880008888888800000000000000
b3bbbbbb6000744446ccf630050036fcccccccccccccc60644444408888888800008880008880088880088800888008880008880088800888800000000000000
bbbbbbbb6000744446cccf630060036fccccccccccccc60654444408888888000000000888880088800000000888008880008880088800088800000000000000
bbb3775005007444466fcccf630060036fccccccccccc60755544408880088800000888888880088800000000888008880008880088800088800000000000000
bbb37750050076f66ffcccccf630060036fcccccccccc60754444408880088800008888008880088800000000888008880008880088800088800000000000000
bbb37750050076ccccccccccccf630060036fcccccccc60654444608880008880008880008880088880088800888008880008880088800888800000000000000
bbb33330050076cccccccccccccf630060036fccccccf60644666608880008880008888888880008888888000888008880008880008888888800000000000000
bbb37750050076cccccccccccccccf630060036fffb3300544666608880000888000888808880000888880000888008880008880000888088800000000000000
bbb37750050066cccccccccccccccccf630060033330065554444600000000000000000000000000000000000000000000000000000000088800000000000000
bbb33330050076ccccccccccccccccccf63006006600634544446600000000000000000000000000000000000000000000000000088888888000000000000000
bbb37750050076cccccccccccccccccccc6b30060063333444446600000000000000000000000000000000000000000000000000008888880000000000000000
bbb37750050066ccccccccccccccccccccf6b3006637333444666600000000000000000000000000000000000000000000000000000000000000000000000000
bbb33336000076cccccccccccccccccccccfb6003733335466666600000000000000000000000000000000000000000000000000000000000000000000000000
33bbb333600066ccccccccccccccccccccfb60067333333446666600000000000000000000000000000000000000000000000000000000000000000000000000
43555444360066cccccccccccccccccccc6006733b33335444466400000000000000000000000000000000000000000000000000000000000000000000000000
454444453600666ccccccccccccccccccc600633b333335544444400000000000000000000000000000000000000000000000000000000000000000000000000
66466444436006366ccccccccccccccccc7007bbbbbb333544455500000000000000000000000000000000000000000000000000000000000000000000000000
444446644553600736cccccccccccccccc7007b33344b33353533300000000000000000000000000000000000000000000000000000000000000000000000000
4444444444453700636ccccccccccccccc6006334355553333333300000000000000000000000000000000000000000000000000000000000000000000000000
44466444464433360063666666ccccccf36006354444445333333300000000000000000000000000000000000000000000000000000000000000000000000000
6666f4444664433360066776666ccccf360063354444445333333300000000000000000000000000000000000000000000000000000000000000000000000000
666f6ff4446664445360000000067766006554446644444533333300000000000000000000000000000000000000000000000000000000000000000000000000
fff6ffff4466664444366776600000000654444446f4444333333300000000000000000000000000000000000000000000000000000000000000000000000000
f6fff6ff446666664555555554667766454446666666444445433300000000000000000000000000000000000000000000000000000000000000000000000000
fffff6ff446666664445555555333333554446444666446445433300000000000000000000000000000000000000000000000000000000000000000000000000
666ff6664444666f6444444555444455544454444664444445433300000000000000000000000000000000000000000000000000000000000000000000000000
6f666f6444554445666446644446644446544544f644444644354300000000000000000000000000000000000000000000000000000000000000000000000000
66666ff44445544455f6466666666666644444444646644466445300000000000000000000000000000000000000000000000000000000000000000000000000
66666f64444455555446666666664666454444444664644646464400000000000000000000000000000000000000000000000000000000000000000000000000
66666644444444555546666664666464444446664664664446466500000000000000000000000000000000000000000000000000000000000000000000000000
6666f66f666ff644444444444644464454466f646666646444444400000000000000000000000000000000000000000000000000000000000000000000000000
66666f6ff6f6fffff444444444444444444446666666f44464544600000000000000000000000000000000000000000000000000000000000000000000000000
__map__
